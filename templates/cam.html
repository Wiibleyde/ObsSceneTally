<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cam {{ camId }}</title>
</head>
<style>
    @import url('https://fonts.googleapis.com/css2?family=Montserrat:wght@300&display=swap');

    body {
        font-family: 'Montserrat', sans-serif;
        color: white;
        background-color: black;
        text-align: center;
    }

    h1 {
        font-size: 10rem;
        margin: 0;
    }

    p {
        font-size: 5rem;
        margin: 0;
    }
</style>
<script>
    let camId = "{{ camId }}"
    let apiLinks = []

    // layer goes from 1 to 3
    for (let i = 1; i <= 3; i++) {
        apiLinks.push("/getCamStatus?camId=" + camId + "&layer=" + i)
    }

    function updateCamStatus() {
        let promises = apiLinks.map(apiLink => fetchCamStatus(apiLink))

        Promise.all(promises)
            .then(results => {
                if (results.includes(true)) {
                    let layer = results.indexOf(true) + 1
                    document.body.style.backgroundColor = "green"
                    document.getElementById("camStatus").innerHTML = "Live on layer " + layer
                } else {
                    document.body.style.backgroundColor = "red"
                    document.getElementById("camStatus").innerHTML = "Offline"
                }
            })
            .catch(error => {
                console.log(error);
                document.body.style.backgroundColor = "black"
                document.getElementById("camStatus").innerHTML = "Error"
            });
    }

    function fetchCamStatus(apiLink) {
        return new Promise((resolve, reject) => {
            fetch(apiLink)
                .then(response => response.json())
                .then(data => {
                    resolve(data.status)
                })
                .catch(error => {
                    console.log(error)
                    reject(false)
                })
        })
    }

    setInterval(updateCamStatus, 500)
</script>

<body>
    <h1>Tally cam {{ camId }}</h1>
    <p>Cam status: <span id="camStatus"></span></p>
</body>

</html>